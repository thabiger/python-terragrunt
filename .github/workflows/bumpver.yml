name: Bump Version

on:
  workflow_dispatch:
    inputs:
      part:
        description: Which part to bump
        required: true
        default: patch
        type: choice
        options:
          - patch
          - minor
          - major
      push:
        description: Push commit and tag
        required: true
        default: true
        type: boolean

jobs:
  bump:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - uses: astral-sh/setup-uv@v4

      - name: Configure git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Bump version
        run: |
          case "${{ github.event.inputs.part }}" in
            patch) uvx bumpver update --patch --no-fetch ;;
            minor) uvx bumpver update --minor --no-fetch ;;
            major) uvx bumpver update --major --no-fetch ;;
          esac

      - name: Push changes and tags
        if: ${{ github.event.inputs.push == 'true' }}
        run: |
          git push --follow-tags
      
      # - name: Trigger release workflow
      #   if: ${{ github.event.inputs.push == 'true' }}
      #   run: |
      #     # Get the new version/tag name
      #     NEW_VERSION=$(python -c "import tomllib; data=tomllib.load(open('pyproject.toml','rb')); print(data['project']['version'])")
      #     echo "Triggering release workflow for tag: $NEW_VERSION"
      #     gh workflow run release.yml --ref "$NEW_VERSION" -f tag="$NEW_VERSION"
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


